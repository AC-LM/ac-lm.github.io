<!DOCTYPE HTML>

<html><head>
    <title>LM</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="icon" href="/images/Infinite.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css"/>
</head><body class="is-preload" id="top">
        

        <div id="wrapper">
<header id="header">
    <h1><a href="/" style="font-size: 1.2em">LM' s Note</a></h1>
    <nav class="links">
        <ul>
            <li><a href="/posts" style="font-size: 0.9em"><strong>Posts</strong></a></li>
        </ul>
    </nav>
    <nav class="main">
        <ul>
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" action="/404.html">
                    <input type="text" name="query" placeholder="请输入关键字"/>
                </form>
            </li>
            <li class="menu">
                
                <a href="/posts" class="fa-bars">Post</a>
            </li>
        </ul>
    </nav>
</header>
            
<div id="main">
    <header>
            <div class="title">
                <h2 style="font-size:2em"><a href="javascript:void(0)"></a></h2>
                <p>@LM | 0001-01-01</p>
            </div>
        </header>
        <div class="content">
            <p><a href="https://www.jianshu.com/p/9738e53a7db3">上传文件模块MultipartEncoder - 简书 (jianshu.com)</a></p>
<h1 id="上传文件模块multipartencoder">上传文件模块MultipartEncoder</h1>
<pre tabindex="0"><code>安装

pip install requests_toolbelt
官方给我们提供的上传文件示例用法：

from requests_toolbelt import MultipartEncoder

encoder = MultipartEncoder({
            'field': ('file_name', b'{&quot;a&quot;: &quot;b&quot;}', 'application/json',
                      {'X-My-Header': 'my-value'})
        })
field：服务端约定的上传文件字段名。一般用到的是file，需要和服务端沟通获取。

file_name: 文件名。一般可以任意写，服务端大多是拿到文件后自己再次命名。

b'{&quot;a&quot;:&quot;b&quot;}'：文件内容。例：open('/your/file/path', 'rb')

'application/json'：文件的MimeType。不同文件类型对应的MimeType可以到这里查询。

{'X-My-Header': 'my-value'}：其他内容，可不传。

payload = {
    'file': ('upload.pdf', open('sync_test.pdf', 'rb'), 'application/pdf')
}
m = MultipartEncoder(payload)
实例


import requests
from requests_toolbelt import MultipartEncoder


upload_url = 'https://your/upload/url'
payload = {
    'file': ('upload.pdf', open('sync_test.pdf', 'rb'), 'application/pdf')
}
m = MultipartEncoder(payload)
headers = {
    &quot;Content-Type&quot;: m.content_type,
    &quot;other-keys&quot;: &quot;other-values&quot;
}
r = requests.post(upload_url, headers=headers, data=m)
print(r.json())

作者：山猪打不过家猪
链接：https://www.jianshu.com/p/9738e53a7db3
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
</code></pre><pre tabindex="0"><code>def WebKit_format(data, boundary=&quot;----WebKitFormBoundary*********ABC&quot;, headers=None):
        # 从headers中提取boundary信息
        if headers is None:
            headers = {}
        if &quot;content-type&quot; in headers:
            fd_val = str(headers[&quot;content-type&quot;])
            if &quot;boundary&quot; in fd_val:
                fd_val = fd_val.split(&quot;;&quot;)[1].strip()
                boundary = fd_val.split(&quot;=&quot;)[1].strip()
            else:
                raise Exception(&quot;multipart/form-data头信息错误，请检查content-type key是否包含boundary&quot;)
        # form-data格式定式
        jion_str = '--{}\r\nContent-Disposition: form-data; name=&quot;{}&quot;\r\n\r\n{}\r\n'
        end_str = &quot;--{}--&quot;.format(boundary)
        args_str = &quot;&quot;
        if not isinstance(data, dict):
            raise Exception(&quot;multipart/form-data参数错误，data参数应为dict类型&quot;)
        for key, value in data.items():
            args_str = args_str + jion_str.format(boundary, key, value)
        args_str = args_str + end_str.format(boundary)
        args_str = args_str.replace(&quot;\'&quot;, &quot;\&quot;&quot;)
        return args_str




    def test001_auth_login():
        headers = {'Accept': &quot;application/json&quot;, 'Content-Type': &quot;multipart/form-data; boundary=----WebKitFormBoundary*********ABC&quot;,
                   'Accept-Encoding': &quot;gzip, deflate, br&quot;, 'Connection': &quot;keep-alive&quot;}
        url = &quot;https://www.baidu.com/login/&quot;
        bodyData = {
            &quot;username&quot;: 1234567890,
            &quot;password&quot;: &quot;a123456&quot;,
            &quot;type&quot;: &quot;account&quot;,
            &quot;bindType&quot;: &quot;null&quot;,
            &quot;openId&quot;: &quot;null&quot;
        }
        boundary_body = WebKit_format(data=bodyData, headers=headers)
        print(boundary_body)
        response = requests.post(url, data = boundary_body, headers = headers)
        access_token = regSearchString(response.text, '&quot;access_token&quot;:&quot;(.+?)&quot;,', 16, -2)
        print(&quot;正则--获取登陆的access_token:  &quot; + access_token)
        print(response.text)
        time.sleep(1)
        

boundary_body = WebKit_format(data=bodyData, headers=headers)

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name=&quot;v&quot;

2.0
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name=&quot;req&quot;

{&quot;cno&quot;: &quot;1213058673616305&quot;}
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name=&quot;sig&quot;

1
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name=&quot;ts&quot;

1
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name=&quot;appid&quot;

dp3wY4YtycajNEz23zZpb5Jl
------WebKitFormBoundary7MA4YWxkTrZu0gW--
</code></pre>
            <p style="margin-top:1em;"></p>
        </div>
        <footer>
            <p class="post-copyright-license" style="margin-top:1em; margin-bottom:1em">
                <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                                                            rel="noopener" target="_blank"><i
                    class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。
            </p>
        </footer>
    
    <ul class="actions pagination" style="margin-bottom:5px; float:right">
        <li><a href="#top" class="button large">回到顶部</a></li>
        
          <li><a href="https://ac-lm.github.io/posts/python/z11/" class="button large previous">上一页</a></li>
        
        
          <li><a href="https://ac-lm.github.io/posts/python/z1/" class="button large next">下一页</a></li>
        
    </ul>
</div>


        </div>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/browser.min.js"></script>
<script src="/assets/js/breakpoints.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script></body>
</html>

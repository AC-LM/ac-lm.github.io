<!DOCTYPE HTML>

<html><head>
    <title>LM</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="icon" href="/images/Infinite.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css"/>
</head><body class="is-preload" id="top">
        

        <div id="wrapper">
<header id="header">
    <h1><a href="/" style="font-size: 1.2em">LM' s Note</a></h1>
    <nav class="links">
        <ul>
            <li><a href="/posts" style="font-size: 0.9em"><strong>Posts</strong></a></li>
        </ul>
    </nav>
    <nav class="main">
        <ul>
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" action="/404.html">
                    <input type="text" name="query" placeholder="请输入关键字"/>
                </form>
            </li>
            
        </ul>
    </nav>
</header>
            
<div id="main">
    <header>
            <div class="title">
                <h2 style="font-size:2em"><a href="javascript:void(0)">Python(11)—多线程的使用</a></h2>
                <p>@LM | 2020-12-13</p>
            </div>
        </header>
        <div class="content">
            <blockquote>
<p>参考原文：<a href="https://www.cnblogs.com/fnng/p/3670789.html"> python 多线程  @虫师 </a></p>
</blockquote>
<h2 id="1单线程">1.单线程</h2>
<p>单线程执行任务时需要进行排序，比如下面代码中的听音乐和看电影两件事。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># coding=utf-8</span>
<span style="color:#f92672">from</span> time <span style="color:#f92672">import</span> ctime,sleep

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">music</span>(func):
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;I was listening to </span><span style="color:#e6db74">{</span>func<span style="color:#e6db74">}</span><span style="color:#e6db74">! </span><span style="color:#e6db74">{</span>ctime()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        sleep(<span style="color:#ae81ff">1</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">move</span>(func):
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;I was at the </span><span style="color:#e6db74">{</span>func<span style="color:#e6db74">}</span><span style="color:#e6db74">! </span><span style="color:#e6db74">{</span>ctime()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        sleep(<span style="color:#ae81ff">5</span>)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    music(<span style="color:#e6db74">&#39;爱情买卖&#39;</span>)
    move(<span style="color:#e6db74">&#39;阿凡达&#39;</span>)
    
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;all over </span><span style="color:#e6db74">{</span>ctime()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><p>在执行时，先执行听音乐这件事，通过<code>for</code>循环来控制音乐播放两次，每首音乐播放需要1秒钟。接着执行看电影，每一场电影需要5秒钟，同样通过<code>for</code>循环看两遍。最后输出结束时间。</p>
<p>运行结果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">========================</span> RESTART <span style="color:#f92672">================================</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> 
I was listening to 爱情买卖<span style="color:#960050;background-color:#1e0010">!</span> Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">48</span>:<span style="color:#ae81ff">59</span> <span style="color:#ae81ff">2014</span>
I was listening to 爱情买卖<span style="color:#960050;background-color:#1e0010">!</span> Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">49</span>:<span style="color:#ae81ff">00</span> <span style="color:#ae81ff">2014</span>
I was at the 阿凡达<span style="color:#960050;background-color:#1e0010">!</span> Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">49</span>:<span style="color:#ae81ff">01</span> <span style="color:#ae81ff">2014</span>
I was at the 阿凡达<span style="color:#960050;background-color:#1e0010">!</span> Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">49</span>:<span style="color:#ae81ff">06</span> <span style="color:#ae81ff">2014</span>
all over Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">49</span>:<span style="color:#ae81ff">11</span> <span style="color:#ae81ff">2014</span>
</code></pre></div><h2 id="2多线程">2.多线程</h2>
<p>在多线程中，我们同时执行多个任务！<code>Python</code>中可以使用<code>threading</code> 来实现多线程，示例代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#coding=utf-8</span>
<span style="color:#f92672">import</span> threading
<span style="color:#f92672">from</span> time <span style="color:#f92672">import</span> ctime,sleep

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">music</span>(func):
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;I was listening to </span><span style="color:#e6db74">{</span>func<span style="color:#e6db74">}</span><span style="color:#e6db74">! </span><span style="color:#e6db74">{</span>ctime()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        sleep(<span style="color:#ae81ff">1</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">move</span>(func):
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;I was at the </span><span style="color:#e6db74">{</span>func<span style="color:#e6db74">}</span><span style="color:#e6db74">! </span><span style="color:#e6db74">{</span>ctime()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
        sleep(<span style="color:#ae81ff">5</span>)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    threads <span style="color:#f92672">=</span> []
    t1 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>music, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;爱情买卖&#39;</span>,))
    threads<span style="color:#f92672">.</span>append(t1)
    t2 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>move, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;阿凡达&#39;</span>,))
    threads<span style="color:#f92672">.</span>append(t2)
    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> threads:
        t<span style="color:#f92672">.</span>setDaemon(<span style="color:#66d9ef">True</span>)
        t<span style="color:#f92672">.</span>start()

    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;all over </span><span style="color:#e6db74">{</span>ctime()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">threads <span style="color:#f92672">=</span> []
t1 <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(target<span style="color:#f92672">=</span>music, args<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;爱情买卖&#39;</span>,))
threads<span style="color:#f92672">.</span>append(t1)

<span style="color:#75715e"># 创建了 threads 数组，创建线程 t1,使用 threading.Thread() 方法，在这个方法中调用 music 方法 target=music，args 方法对 music 进行传参。把创建好的线程 t1 装到 threads 数组中。</span>
</code></pre></div><hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> threads:
    t<span style="color:#f92672">.</span>setDaemon(<span style="color:#66d9ef">True</span>)
    t<span style="color:#f92672">.</span>start()
<span style="color:#75715e"># 最后通过 for 循环遍历数组。（数组被装载了t1和t2两个线程）</span>
setDaemon()
<span style="color:#75715e"># setDaemon(True) 将线程声明为守护线程，必须在 start() 方法调用之前设置，如果不设置为守护线程程序会被无限挂起。子线程启动后，父线程也继续执行下去，当父线程执行完最后一条语句后，没有等待子线程，直接就退出了，同时子线程也一同结束</span>
start()
<span style="color:#75715e"># 开始线程活动</span>
</code></pre></div><p>运行结果：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">=========================</span> RESTART <span style="color:#f92672">================================</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> 
I was listening to 爱情买卖<span style="color:#f92672">.</span> Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">45</span> <span style="color:#ae81ff">2014</span> 
I was at the 阿凡达<span style="color:#960050;background-color:#1e0010">!</span> Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">45</span> <span style="color:#ae81ff">2014</span>
all over Thu Apr <span style="color:#ae81ff">17</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">51</span>:<span style="color:#ae81ff">45</span> <span style="color:#ae81ff">2014</span>
</code></pre></div><p>从执行结果来看，子线程和主线程都是同一时间启动，但由于主线程执行完结束，所以导致子线程也终止。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">...</span>
<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> threads:
        t<span style="color:#f92672">.</span>setDaemon(<span style="color:#66d9ef">True</span>)
        t<span style="color:#f92672">.</span>start()
    
    t<span style="color:#f92672">.</span>join()

    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;all over </span><span style="color:#e6db74">{</span>ctime()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
<span style="color:#75715e"># 我们只对上面的程序加了个 join() 方法，用于等待线程终止。join() 的作用是，在子线程完成运行之前，这个子线程的父线程将一直被阻塞。</span>
<span style="color:#75715e"># 注意: join() 方法的位置是在 for 循环外的，也就是说必须等待 for 循环里的两个进程都结束后，才去执行主进程。</span>
</code></pre></div>
            <p style="margin-top:1em;"></p>
        </div>
        <footer>
            <p class="post-copyright-license" style="margin-top:1em; margin-bottom:1em">
                <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                                                            rel="noopener" target="_blank"><i
                    class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。
            </p>
        </footer>
    
    <ul class="actions pagination" style="margin-bottom:5px; float:right">
        <li><a href="#top" class="button large">回到顶部</a></li>
        
          <li><a href="https://ac-lm.github.io/posts/python/python10%E5%AD%90%E7%B1%BB%E7%9A%84-super-%E5%88%9D%E5%A7%8B%E5%8C%96/" class="button large previous">上一页</a></li>
        
        
          <li><a href="https://ac-lm.github.io/posts/python/python12%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC/" class="button large next">下一页</a></li>
        
    </ul>
</div>


        </div>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/browser.min.js"></script>
<script src="/assets/js/breakpoints.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script></body>
</html>

<!DOCTYPE HTML>

<html><head>
    <title>LM</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="icon" href="/images/Infinite.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css"/>
</head><body class="is-preload" id="top">
        

        <div id="wrapper">
<header id="header">
    <h1><a href="/" style="font-size: 1.2em">LM' s Note</a></h1>
    <nav class="links">
        <ul>
            <li><a href="/posts" style="font-size: 0.9em"><strong>Posts</strong></a></li>
        </ul>
    </nav>
    <nav class="main">
        <ul>
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" action="/404.html">
                    <input type="text" name="query" placeholder="请输入关键字"/>
                </form>
            </li>
            
        </ul>
    </nav>
</header>
            
<div id="main">
    <header>
            <div class="title">
                <h2 style="font-size:2em"><a href="javascript:void(0)">Net(1)——iperf 与 netperf 网络性能测量工具</a></h2>
                <p>@LM | 2020-11-15</p>
            </div>
        </header>
        <div class="content">
            <h2 id="1iperf">1.iperf</h2>
<p><a href="https://iperf.fr/"> iperf 官网下载 </a></p>
<p>iPerf 是一种网络性能测试工具，能对协议、定时、缓冲区等参数进行配置调整，能够测试<strong>TCP/UDP最大带宽、延迟抖动、数据包丢失</strong>等信息。</p>
<p><strong>iPerf基于Server/Client的工作模式</strong>，客户端向服务端发送一定数量的数据，服务端统计并记录带宽、延时抖动等信息。客户端将数据全部发送后，服务端会回复一个数据包给客户端，将测试数据反馈给客户端。不过，如果网络较为拥塞或者误码率较高，客户端无法收到服务端回复的数据包，则只能显示本地记录的部分测试结果，所以服务端和客户端的测试结果可能有所不同。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 安装</span>
rpm -ivh xxxx.rpm
<span style="color:#75715e"># iPerf命令语法格式</span>
iperf <span style="color:#f92672">[</span>-s|-c host<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span>
iperf3 -s <span style="color:#75715e"># 服务器</span>
iperf3 -c ServerIP <span style="color:#75715e"># 客户机</span>
<span style="color:#75715e"># 配置软链接</span>
cd /usr/bin
ln -s iperf3 iperf
</code></pre></div><h2 id="2netperf">2.netperf</h2>
<p><a href="https://hewlettpackard.github.io/netperf/"> netperf 官网下载  </a></p>
<p>Netperf是一种网络性能测量工具，主要用于<strong>测试TCP或UDP和Berkeley套接字接口的批量数据传输（bulk data transfer）和请求/应答（request/reponse）性能</strong>。</p>
<p><strong>Netperf工具以Client/Server方式工作</strong>，服务端是netServer，用来侦听来自客户端的连接，客户端是netperf，用来向服务发起网络测试。在客户端与服务端之间，首先建立一个控制连接，传递有关测试配置的信息，以及测试的结果。在控制连接建立并传递了测试配置信息以后，客户端与服务端之间会再建立一个测试连接，用于来回传递特殊的流量，以测试网络的性能。当netServer在服务端启动后，就可在客户端运行netperf来测试网络的性能。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rpm -ivh xxxx.rpm
netperf -V
<span style="color:#75715e"># 安装完以后，会生成两个工具：netserver 和 netperf</span>
netserver -D -p <span style="color:#ae81ff">9991</span> <span style="color:#75715e"># 服务器，-D 前台运行，-p 指定端口</span>
netperf -H host <span style="color:#75715e"># 客户端</span>
</code></pre></div><h2 id="3网络性能指标">3.网络性能指标</h2>
<ul>
<li><strong>网络吞吐量</strong>：单位时间内通过某个网络（信道或接口）的数据量，吞吐量受网络的带宽或者网络的额定速率限制，单位通常表示为bit/s或bps。</li>
<li><strong>网络延时</strong>：一个数据包从用户的计算机发送到网站服务器，然后再立即从网站服务器返回用户计算机的来回时间。影响网络延时的主要因素是路由的跳数和网络的流量。交换机延时（Latency）是指从交换机接收到数据包到开始向目的端口复制数据包之间的时间间隔。有许多因素会影响交换机延时大小，比如转发技术等等。</li>
<li><strong>抖动</strong>：用于描述包在网络中的传输延时的变化，抖动越小，说明网络质量越稳定越好。抖动是评价一个网络性能的最重要的因素。</li>
<li><strong>丢包率</strong>：理想状态下是发送了多少数据包就能接收到多少数据包，但是由于信号衰减、网络质量等诸多因素的影响并不能达到理想状态，而丢包率就是指测试中所丢失的数据包数量占所发送的数据包的比率。</li>
</ul>
<h2 id="4-基于-iperf-测试-sdn-网络">4. 基于 iPerf 测试 SDN 网络</h2>
<h3 id="tcp测试">TCP测试</h3>
<p>步骤1：在主机1上执行 <strong>iperf -s</strong> 命令，以主机1为服务器端进行TCP测试。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">---------------------------------
Server listening on <span style="color:#ae81ff">5201</span>
-----------------------------------
<span style="color:#75715e"># 说明：服务器端默认端口为5201</span>
</code></pre></div><p>步骤2：在主机2上执行 <strong>iperf -c 主机1-IP</strong> 命令，以主机2为客户端去连接主机1，测试主机1与主机2之间的吞吐量。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iperf -c 192.168.1.243
----------------------------------------------
<span style="color:#f92672">[</span>ID<span style="color:#f92672">]</span> Interval         Transfer      Bandwidth
<span style="color:#f92672">[</span>4<span style="color:#f92672">]</span> 0.00-30.00  sec   <span style="color:#ae81ff">341</span> MBytes     95.4 MBytes/sec
<span style="color:#75715e"># 结果表明主机1与主机2之间的带宽是95.4 Mbit/s</span>
</code></pre></div><p>步骤3：<strong>添加参数</strong>测试以下命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iperf -c 主机1-IP -t <span style="color:#ae81ff">32</span> -i <span style="color:#ae81ff">8</span>
<span style="color:#75715e"># -t 32 表示测试时间为32s，-i 8 表示输出频率为8s。该命令表示每8s输出一次测试结果，直到达到32s为止</span>
iperf -c 主机1-IP -n 2000M -i <span style="color:#ae81ff">5</span>
<span style="color:#75715e"># -n 2000M 表示传输的数据量为2000M，-i 5 表示输出频率为5s。该命令表示每5s输出一次测试结果，到最接近总时间为止，最后再输出总的测试结果</span>
</code></pre></div><h3 id="udp测试">UDP测试</h3>
<p>步骤1：在主机1上执行 <strong>iperf -s</strong> 命令，以主机1为服务器端进行UDP测试。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">---------------------------------
Server listening on <span style="color:#ae81ff">5201</span>
-----------------------------------
<span style="color:#75715e"># 说明：服务器端默认端口为5201</span>
</code></pre></div><p>步骤2：在主机2上执行命令 <strong>iperf -c 主机1-IP -u</strong>，以主机2为客户端去连接主机1，测试主机1与主机2之间的网络性能。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iperf -c 192.168.1.243
----------------------------------------------
<span style="color:#f92672">[</span>ID<span style="color:#f92672">]</span> Interval         Transfer      Bandwidth          Jitter     Lost/Total Datagrams
<span style="color:#f92672">[</span>4<span style="color:#f92672">]</span> 0.00-30.00  sec   <span style="color:#ae81ff">341</span> MBytes     95.4 MBytes/sec    0.421 ms    70050/77741 <span style="color:#f92672">(</span>90%<span style="color:#f92672">)</span>
<span style="color:#75715e"># 结果表明主机1与主机2之间的带宽是95.4 Mbit/s</span>
</code></pre></div><p>步骤3：<strong>添加参数</strong>测试以下命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iperf -c 主机1-IP -u -b 2000M -i <span style="color:#ae81ff">5</span>
<span style="color:#75715e"># -b 2000M 指定客户端以2000Mbps为数据发送速率，-i 5 表示输出频率为5s</span>
</code></pre></div><h2 id="5基于netperf测试sdn网络">5.基于Netperf测试SDN网络</h2>
<h3 id="tcp测试-1">TCP测试</h3>
<p>步骤1：在主机1上运行服务器端，用-p指定监听端口为9991</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">netserver -D -p <span style="color:#ae81ff">9991</span>
</code></pre></div><p>步骤2：在主机2上运行客户端，指定服务器端的IP地址以及端口。缺省情况下Netperf进行TCP批量传输，即-t TCP_STREAM</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">netperf -H 192.168.1.180 -p <span style="color:#ae81ff">9991</span>
MIGRATED TCP STREAM TEST from 0.0.0.0 <span style="color:#f92672">(</span>0.0.0.0<span style="color:#f92672">)</span> port <span style="color:#ae81ff">0</span> AF_INET to 192.168.1.180 <span style="color:#f92672">(</span>0.0.0.0<span style="color:#f92672">)</span> port <span style="color:#ae81ff">0</span> AF_INET
Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

 <span style="color:#ae81ff">87380</span>  <span style="color:#ae81ff">16384</span>  <span style="color:#ae81ff">16384</span>    10.47      86.40   
<span style="color:#75715e"># 服务器端使用87380字节大小的socket接收缓冲，客户端使用16384字节大小的socket发送缓冲。缺省情况下，Netperf向发送的测试分组大小设置为本地系统所使用的socket发送缓冲大小，即向服务器端发送的测试分组大小也是16384字节，用时10.47s，吞吐量为86.4*10^6 bits/s。</span>
<span style="color:#ae81ff">1</span> Byte <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span> bit 
<span style="color:#ae81ff">1</span> KB<span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> B 
<span style="color:#ae81ff">1</span> MB <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> KB 
<span style="color:#ae81ff">1</span> GB <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> MB 
<span style="color:#ae81ff">1</span> TB <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> GB
</code></pre></div><h3 id="udp测试-1">UDP测试</h3>
<p>步骤3：在主机2上执行以下命令进行UDP测试</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">netperf -t UDP_STREAM -H 10.0.0.2 -p <span style="color:#ae81ff">9991</span>
netperf -t UDP_STREAM -H 192.168.180.130 -l <span style="color:#ae81ff">60</span>
netperf -t UDP_STREAM -H 192.168.180.130  -- -m <span style="color:#ae81ff">2048</span>
<span style="color:#75715e"># UDP_STREAM: UDP批量传输</span>
<span style="color:#75715e"># -l 指定时间 -m 设置本地系统发送测试分组的大小</span>
</code></pre></div><p>步骤4：尝试使用以下命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">netperf -t TCP_RR -H 172.20.35.40 -l <span style="color:#ae81ff">10</span> -- -r 256,2048
<span style="color:#75715e"># -r 用于指定客户端和服务端每次的交互数据量，上面表示客户端每次发送256字节，服务器每次回复2048字节</span>
<span style="color:#75715e"># TCP_RR 长连接 TCP_CRR 短连接 UDP_RR 长连接 </span>
</code></pre></div>
            <p style="margin-top:1em;"></p>
        </div>
        <footer>
            <p class="post-copyright-license" style="margin-top:1em; margin-bottom:1em">
                <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                                                            rel="noopener" target="_blank"><i
                    class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。
            </p>
        </footer>
    
    <ul class="actions pagination" style="margin-bottom:5px; float:right">
        <li><a href="#top" class="button large">回到顶部</a></li>
        
        
          <li><a href="https://ac-lm.github.io/posts/%E7%BD%91%E7%BB%9C%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/net2nmap-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7/" class="button large next">下一页</a></li>
        
    </ul>
</div>


        </div>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/browser.min.js"></script>
<script src="/assets/js/breakpoints.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script></body>
</html>

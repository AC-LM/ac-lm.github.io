<!DOCTYPE HTML>

<html><head>
    <title>LM</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="icon" href="/images/Infinite.png" type="image/x-icon">
    <link rel="stylesheet" href="/assets/css/main.css"/>
</head><body class="is-preload" id="top">
        

        <div id="wrapper">
<header id="header">
    <h1><a href="/" style="font-size: 1.2em">LM' s Note</a></h1>
    <nav class="links">
        <ul>
            <li><a href="/posts" style="font-size: 0.9em"><strong>Posts</strong></a></li>
        </ul>
    </nav>
    <nav class="main">
        <ul>
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="#">
                    <input type="text" name="query" placeholder="施工中" disabled="disabled"/>
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>
<section id="menu">
    
    <section>
        <h2>施工中</h2>
    </section>
</section>
<div id="main">
    <header>
            <div class="title">
                <h2 style="font-size:2em"><a href="javascript:void(0)">Net(6)——wireshark网络抓包工具</a></h2>
                <p>@LM | 2021-06-21</p>
            </div>
        </header>
        <div class="content">
            <blockquote>
<p>参考原文：<a href="https://zhuanlan.zhihu.com/p/82498482"> Wireshark抓包使用指南@Ju5tice </a></p>
</blockquote>
<h2 id="0x01wireshark可以做什么">0x01.Wireshark可以做什么</h2>
<ul>
<li>网络管理员使用Wireshark检测网络问题</li>
<li>网安工程师用Wireshark检查信息安全相关问题</li>
<li>开发者使用Wireshark为新的通信协议调试</li>
<li>普通用户使用Wireshark学习网络协议相关知识</li>
</ul>
<h2 id="0x02wireshark不可以做什么">0x02.Wireshark不可以做什么</h2>
<ul>
<li>Wireshark不是入侵侦测软件（Intrusion Detection Software, IDS）。对于网络上的异常流量行为，Wireshark不会产生警示或是任何提示。然而，仔细分析Wireshark截取的数据包能够帮助用户对于网络行为有更清楚的了解。</li>
<li>Wireshark不会对网络数据包产生内容的修改 - 它只会反映出当前流通的数据包信息。 Wireshark本身也不会提交数据包至网络上。就是说你只能查看数据包，不能修改或转发。</li>
</ul>
<h2 id="0x03抓包实例">0x03.抓包实例</h2>
<p>打开wireshark，主界面如下：</p>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621172145.png" alt="img"></p>
<p>双击上图的中的过滤器（捕获），开始抓包</p>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621172520.png" alt="img"></p>
<p>打开 cmd 窗口，执行 ping 命令。工作中的 wireshark 将抓取到相关数据包，在过滤栏设置过滤条件以避免其他无用数据包影响分析，<strong>比如：ip.addr == 185.199.111.153 and icmp 表示只显示ICPM协议且源主机IP或者目的主机IP为185.199.111.153的数据包。说明：协议名称icmp要小写</strong></p>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621172620.png" alt=""></p>
<h2 id="0x04数据包详细信息">0x04.数据包详细信息</h2>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621172744.png" alt="img"></p>
<ul>
<li>Frame: 物理层的数据帧概况</li>
<li>Ethernet II: 数据链路层以太网帧头部信息</li>
<li>Internet Protocol Version 4: 互联网层IP包头部信息</li>
<li>Transmission Control Protocol: 传输层T的数据段头部信息，此处是TCP</li>
<li>Hypertext Transfer Protocol: 应用层的信息，此处是HTTP协议</li>
</ul>
<h2 id="0x05tcp包的具体内容">0x05.TCP包的具体内容</h2>
<p>从下图可以看到wireshark捕获到的TCP包中的每个字段。</p>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621172847.png" alt=""></p>
<h2 id="0x06抓包捕获过滤器语法和实例">0x06.抓包（捕获）过滤器语法和实例</h2>
<p>抓包过滤器有如：类型Type（host、net、port）、方向Dir（src、dst）、协议Proto（ether、ip、tcp、udp、http、icmp、ftp等）、逻辑运算符（&amp;&amp; 与、|| 或、！非）等的分类</p>
<h3 id="1协议过滤">（1）协议过滤</h3>
<p>直接在过滤框中输入协议名即可。 tcp，只显示TCP协议的数据包列表 ；http，只查看HTTP协议的数据包列表 ；icmp，只显示ICMP协议的数据包列表</p>
<h3 id="2ip过滤">（2）IP过滤</h3>
<p>host 192.168.1.104 ；src host 192.168.1.104 ；dst host 192.168.1.104</p>
<h3 id="3端口过滤">（3）端口过滤</h3>
<p>port 80 ；src port 80 ；dst port 80</p>
<h3 id="4逻辑运算符-与-或非">（4）逻辑运算符&amp;&amp; 与、|| 或、！非</h3>
<p>src host 192.168.1.104 &amp;&amp; dst port 80 抓取主机地址为192.168.1.80、目的端口为80的数据包； host 192.168.1.104 || host 192.168.1.102 抓取主机为192.168.1.104或者192.168.1.102的数据包 ；! broadcast 不抓取广播数据包</p>
<h2 id="0x07显示过滤器语法和实例">0x07.显示过滤器语法和实例</h2>
<h3 id="1比较操作符">（1）比较操作符</h3>
<p>比较操作符有 == 等于、! = 不等于、&gt; 大于、&lt; 小于、&gt;= 大于等于、&lt;= 小于等于。</p>
<h3 id="2协议过滤">（2）协议过滤</h3>
<p>直接在Filter框中输入协议名即可。注意：协议名称需要输入小写。 tcp，只显示TCP协议的数据包列表 ；http，只查看HTTP协议的数据包列表；icmp，只显示ICMP协议的数据包列表</p>
<h3 id="3-ip过滤">（3） ip过滤</h3>
<p>ip.src ==192.168.1.104 显示源地址为192.168.1.104的数据包列表； ip.dst==192.168.1.104, 显示目标地址为192.168.1.104的数据包列表； ip.addr == 192.168.1.104 显示源IP地址或目标IP地址为192.168.1.104的数据包列表</p>
<h3 id="4端口过滤">（4）端口过滤</h3>
<p>tcp.port ==80, 显示源主机或者目的主机端口为80的数据包列表。 tcp.srcport == 80, 只显示TCP协议的源主机端口为80的数据包列表。 tcp.dstport == 80，只显示TCP协议的目的主机端口为80的数据包列表。</p>
<h3 id="5-http模式过滤">（5） Http模式过滤</h3>
<p>http.request.method==&ldquo;GET&rdquo;, 只显示HTTP GET方法的。</p>
<h3 id="6逻辑运算符为-andornot">（6）逻辑运算符为 and/or/not</h3>
<p>过滤多个条件组合时，使用and/or。比如获取IP地址为192.168.1.104的ICMP数据包表达式为 ip.addr == 192.168.1.104 and icmp</p>
<h3 id="7按照数据包内容过滤">（7）按照数据包内容过滤。</h3>
<p>假设我要以IMCP层中的内容进行过滤，可以单击选中界面中的码流，在下方进行选中数据。右键&ndash;&gt;准备过滤器&ndash;&gt;选中&ndash;&gt;添加条件表达式，如<code>data contains &quot;uestc&quot;</code></p>
<h2 id="0x08wireshark分析tcp协议三次握手">0x08.Wireshark分析TCP协议三次握手</h2>
<h3 id="tcp三次握手连接建立过程">TCP三次握手连接建立过程</h3>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621173538.png" alt=""></p>
<ul>
<li>第一次握手：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。</li>
<li>第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；</li>
<li>第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手，客户端与服务器开始传送数据。 {% endtabs %}</li>
</ul>
<h3 id="wireshark抓取访问指定服务器数据包">wireshark抓取访问指定服务器数据包</h3>
<ol>
<li>启动wireshark抓包，打开浏览器输入<code>www.cnblogs.com</code></li>
<li>终止抓包，输入 http 过滤</li>
<li>隐藏其他无关http数据包，右键选中，追踪流——&gt;TCP流，显示握手信息，如图所示：</li>
</ol>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621173726.png" alt=""></p>
<p>可以看到这里截获了三个握手数据包，第四个是HTTP数据包，说明HTTP的确是使用TCP建立连接的。</p>
<hr>
<p><strong>第一次</strong>，客户端发送了一个TCP，标志位为SYN，序列号为0，表示客户端请求建立连接，如下：</p>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621173833.png" alt=""></p>
<p><strong>关键参数</strong></p>
<ol>
<li>SYN ：标志位，表示请求建立连接</li>
<li>Seq = 0 ：初始建立连接值为0，数据包的相对序列号从0开始，表示当前还没有发送数据</li>
<li>Ack = 0：初始建立连接值为0，已经收到包的数量，表示当前没有接收到数据</li>
</ol>
<hr>
<p><strong>第二次</strong>，服务器发回确认包, 标志位为 SYN,ACK. 将确认序号(Acknowledgement Number)设置为客户的ISN加1以.即0+1=1, 如下图如下：</p>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621173941.png" alt=""></p>
<p><strong>关键参数</strong></p>
<ol>
<li>
<p>SYN + ACK：标志位，同意建立连接，并回送SYN+ACK</p>
</li>
<li>
<p>Seq = 0 ：初始建立值为0，表示当前还没有发送数据</p>
</li>
<li>
<p>Ack = 1：表示当前端成功接收的数据位数，虽然客户端没有发送任何有效数据，确认号还是被加1，因为包含SYN或FIN标志位。（并不会对有效数据的计数产生影响，因为含有SYN或FIN标志位的包并不携带有效数据）</p>
</li>
</ol>
<hr>
<p><strong>第三次</strong>，客户端再次发送确认包(ACK) SYN标志位为0,ACK标志位为1.并且把服务器发来ACK的序号字段+1,放在确定字段中发送给对方.并且在数据段放写ISN的+1，如下图如下：</p>
<p><img src="https://gitee.com/LM-J/drawingbed/raw/master/img/20210621174013.png" alt=""></p>
<p><strong>关键参数</strong></p>
<ol>
<li>ACK ：标志位，表示已经收到记录</li>
<li>Seq = 1 ：表示当前已经发送1个数据</li>
<li>Ack = 1 : 表示当前端成功接收的数据位数，虽然服务端没有发送任何有效数据，确认号还是被加1，因为包含SYN或FIN标志位（并不会对有效数据的计数产生影响，因为含有SYN或FIN标志位的包并不携带有效数据)。</li>
</ol>

            <p style="margin-top:1em;"></p>
        </div>
        <footer>
            <p class="post-copyright-license" style="margin-top:1em; margin-bottom:1em">
                <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                                                            rel="noopener" target="_blank"><i
                    class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。
            </p>
        </footer>
    
    <ul class="actions pagination" style="margin-bottom:5px; float:right">
        <li><a href="#top" class="button large">回到顶部</a></li>
        
          <li><a href="https://ac-lm.github.io/posts/%E7%BD%91%E7%BB%9C%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/net1iperf-%E4%B8%8E-netperf-%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%B5%8B%E9%87%8F%E5%B7%A5%E5%85%B7/" class="button large previous">上一页</a></li>
        
        
    </ul>
</div>


        </div>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/browser.min.js"></script>
<script src="/assets/js/breakpoints.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script></body>
</html>
